image: debian/stable
artifacts:
  - ./bin
sources:
  - https://github.com/aparcar/openwrt-clone.git 
packages:
  - build-essential                                                               
  - curl                                                                          
  - file                                                                          
  - gawk                                                                          
  - gettext                                                                       
  - git                                                                           
  - libncurses-dev                                                               
  - libssl-dev                                                                    
  - python3                                                                       
  - rsync                                                                         
  - subversion                                                                    
  - swig                                                                          
  - unzip                                                                         
  - wget                                                                          
  - zlib1g-dev  
tasks:
  - setup: |
      cd openwrt-clone
      TARGET="$(echo $GITHUB_PR_TITLE | cut -d ':' -f 1)"
      echo "CONFIG_TARGET_${TARGET}=y" > .config
      make defconfig
      make prereq
      ./scripts/feeds update
      ./scripts/feeds install -a

  - build: |
      cd openwrt-clone
      make -j $(nproc)
